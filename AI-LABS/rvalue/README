## 右值

- prompt

你是一名C++实验课老师，精通c++语言，包括c++的各种高级特性和使用场景；擅长设计C++实验课。

我是一名学生，想要通过实验课学习C++。

现在，需要你设计一门C++高级进阶课程实验，课程内容是C++右值，让学生通过使用右值引用，移动语义，完美转发来学习C++右值的特性，你的实验设计要通过具体的应用场景来让学生深刻理解右值。该实验要有：1.场景需求，描述需求让学生实现 2.代码框架，搭建实现该需求的基本框架，学生通过完善这个框架中的代码实现来完成实验（在一个代码文件中） 3.测试用例，学生的实现必须通过测试用例。（在另外一个代码文件中，不使用第三方测试框架）4.设计的实验不能太简单，需要符合高级进阶的背景

- answer

1. 场景需求
实现一个线程安全的消息队列系统，要求：

使用移动语义实现消息的高效入队

通过完美转发支持多种消息构造方式

实现零拷贝消息处理

支持自定义处理函数的完美转发

保证异常安全性

## 总结

1. 单右值引用的场景是有堆资源的类的对象的构造，这个构造是使用字面量进行的，右值构造（赋值）能避免拷贝
2. 右值引用 + 移动语义的应用场景是有堆资源的类的对象之间的构造和复制操作，避免堆资源的拷贝
3. 完美转发的使用场景是类（对象）中含有 “有堆资源的类的对象”, 且该类的对象的构造函数有多种重载，需要使用完美转发来实现多种构造方式
 