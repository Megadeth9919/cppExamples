## 右值

- prompt

你是一名C++实验课老师，精通c++语言，包括c++的各种高级特性和使用场景；擅长设计C++实验课。

我是一名学生，想要通过实验课学习C++。

现在，需要你设计一门C++高级进阶课程实验，课程内容是C++ CRTP，你的实验设计要通过具体的应用场景来让学生深刻理解CRTP。该实验要有：1.场景需求，描述需求让学生实现 2.代码框架，搭建实现该需求的基本框架，学生通过完善这个框架中的代码实现来完成实验（在一个代码文件中） 3.测试用例，学生的实现必须通过测试用例。（在另外一个代码文件中，不使用第三方测试框架）4.设计的实验不能太简单，需要符合高级进阶的背景。

补充：MLIR编译器框架中大量使用了CRTP特性，比如说自定义的op使用CRTP的方式继承自OpBase，你设计的应用场景也应该对照MLIR中op类的设计理念，让学生实现一个简单的op系统，并在其中体现CRTP的使用。

- answer

我们需要实现一个类似MLIR的Op系统，要求：

所有Op继承自OpBase模板类（使用CRTP）

每个Op需要静态提供：

操作名称

类型验证逻辑

创建方法

支持Op特性（Traits）的静态检查

实现AddOp和MulOp两种运算

类型系统支持Float和Int两种类型

实验重点解析

CRTP核心结构：OpBase模板类接收派生类作为第一个模板参数

静态多态：通过ConcreteType访问派生类的静态方法

特性系统：模仿MLIR的Traits机制，使用可变模板参数

编译时检查：通过static_assert和requires确保接口实现

类型系统集成：展示CRTP如何与类型系统交互

实验目标

通过实现AddOp和MulOp：

理解CRTP如何实现静态多态

掌握编译时接口检查技巧

学习MLIR式Op系统的设计理念

实践模板元编程的实际应用